<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>Mi Carrito</title>

    <!-- 🔹 Bootstrap CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

    <link rel="stylesheet" th:href="@{/css/carrito.css}">

</head>

<body>
<div layout:fragment="content">
    <div class="top-bar">
        <h1><i class="bi bi-cart3"></i> Mi Carrito</h1>
        <a th:href="@{/menu}">🍔 Seguir Comprando</a>
    </div>

    <div class="carrito-container">

        <!-- Si el carrito está vacío -->
        <div th:if="${#lists.isEmpty(carrito)}" class="carrito-vacio">
            <i class="bi bi-cart-x"></i>
            <h3>Tu carrito está vacío</h3>
            <p>Agrega tus productos favoritos del menú 🍟</p>
            <a th:href="@{/menu}" class="btn btn-seguir">Ver Menú</a>
        </div>

        <!-- Si hay productos -->
        <div th:unless="${#lists.isEmpty(carrito)}" class="row">
            <div class="col-lg-8">
                <div th:each="item : ${carrito}" class="producto-item">
                    <img th:if="${item.producto.imagenUrl}" th:src="${item.producto.imagenUrl}" th:alt="${item.producto.nombre}">
                    <div th:unless="${item.producto.imagenUrl}" style="width:95px; height:95px; background:#eee; border-radius:10px;"></div>

                    <div class="producto-info">
                        <h5 th:text="${item.producto.nombre}">Producto</h5>
                        <p th:text="${item.producto.descripcion}">Descripción del producto</p>
                        <!-- Precio con punto decimal -->
                        <div class="producto-precio" th:text="'S/ ' + ${#numbers.formatDecimal(item.producto.precio,1,2,'POINT')}">S/ 15.00</div>
                    </div>

                    <div class="acciones">
                        <form th:action="@{'/carrito/actualizar/' + ${item.producto.id}}" method="post">
                            <input type="number" name="cantidad" th:value="${item.cantidad}" min="1" max="10">
                            <button type="submit" class="btn-actualizar">
                                <i class="bi bi-arrow-clockwise"></i> Actualizar
                            </button>
                        </form>

                        <a th:href="@{'/carrito/eliminar/' + ${item.producto.id}}" class="btn-eliminar"
                           onclick="return confirm('¿Eliminar este producto del carrito?')">
                            <i class="bi bi-trash"></i> Eliminar
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="resumen">
                    <h4><i class="bi bi-receipt"></i> Resumen del Pedido</h4>

                    <div th:each="item : ${carrito}" class="resumen-item">
                        <span th:text="${item.producto.nombre} + ' x ' + ${item.cantidad}">Producto x 1</span>
                        <span th:text="'S/ ' + ${#numbers.formatDecimal(item.subtotal,1,2,'POINT')}">S/ 10.00</span>
                    </div>

                    <div class="resumen-total">
                        <span>Total</span>
                        <span th:text="'S/ ' + ${#numbers.formatDecimal(total,1,2,'POINT')}">S/ 30.00</span>
                    </div>

                    <div class="botones-acciones">
                        <a th:href="@{/carrito/checkout}" class="btn btn-pago">
                            <i class="bi bi-bag-check"></i> Proceder al Pago
                        </a>
                        <a th:href="@{/menu}" class="btn btn-seguir">
                            <i class="bi bi-plus-circle"></i> Agregar Más Productos
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
